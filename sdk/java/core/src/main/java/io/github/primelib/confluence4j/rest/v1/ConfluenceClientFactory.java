// WARNING: This file was generated by PrimeCodeGen. DO NOT EDIT.

package io.github.primelib.confluence4j.rest.v1;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.MapperFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.PropertyNamingStrategies;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.databind.json.JsonMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import feign.Feign;
import feign.Logger;
import feign.jackson.JacksonDecoder;
import feign.jackson.JacksonEncoder;
import feign.micrometer.MicrometerCapability;
import feign.okhttp.OkHttpClient;
import feign.slf4j.Slf4jLogger;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientAnalyticsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientAnalyticsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientAuditApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientAuditConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentAttachmentsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentAttachmentsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentBodyApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentBodyConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentChildrenAndDescendantsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentChildrenAndDescendantsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentCommentsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentCommentsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentLabelsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentLabelsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentMacroBodyApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentMacroBodyConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentPermissionsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentPermissionsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentPropertiesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentPropertiesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentRestrictionsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentRestrictionsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentStatesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentStatesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentVersionsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentVersionsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentWatchesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientContentWatchesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientDynamicModulesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientDynamicModulesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientExperimentalApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientExperimentalConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientGroupApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientGroupConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientInlineTasksApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientInlineTasksConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientLabelInfoApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientLabelInfoConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientLongRunningTaskApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientLongRunningTaskConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientRelationApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientRelationConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSearchApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSearchConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSettingsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSettingsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpaceApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpaceConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpacePermissionsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpacePermissionsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpacePropertiesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpacePropertiesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpaceSettingsApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientSpaceSettingsConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientTemplateApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientTemplateConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientThemesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientThemesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientUserPropertiesApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientUserPropertiesConsumerApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientUsersApi;
import io.github.primelib.confluence4j.rest.v1.client.ConfluenceClientUsersConsumerApi;
import io.github.primelib.primecodegenlib.java.feign.common.capabilities.PrimeCapability;
import io.github.primelib.primecodegenlib.java.feign.common.interceptor.AuthInterceptor;
import java.net.InetSocketAddress;
import java.net.Proxy;
import java.util.function.Consumer;
import javax.annotation.processing.Generated;
import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import lombok.AccessLevel;
import lombok.NoArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import okhttp3.Credentials;

@NoArgsConstructor(access = AccessLevel.PRIVATE, force = true)
@Slf4j
@Generated(value = "io.github.primelib.primecodegen")
public class ConfluenceClientFactory {
    public static <T> T create(Consumer<ConfluenceClientFactorySpec<T>> spec) {
        ConfluenceClientFactorySpec<T> config = new ConfluenceClientFactorySpec<>(spec);

        if (config.api().isInterface()) {
            return buildClient(spec);
        }
        if (config.api() == ConfluenceClientConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientConsumerApi.class, ConfluenceClientApi.class, (ConfluenceClientFactorySpec<ConfluenceClientConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientAnalyticsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientAnalyticsConsumerApi.class, ConfluenceClientAnalyticsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientAnalyticsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientAuditConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientAuditConsumerApi.class, ConfluenceClientAuditApi.class, (ConfluenceClientFactorySpec<ConfluenceClientAuditConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentConsumerApi.class, ConfluenceClientContentApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentAttachmentsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentAttachmentsConsumerApi.class, ConfluenceClientContentAttachmentsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentAttachmentsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentChildrenAndDescendantsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentChildrenAndDescendantsConsumerApi.class, ConfluenceClientContentChildrenAndDescendantsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentChildrenAndDescendantsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentMacroBodyConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentMacroBodyConsumerApi.class, ConfluenceClientContentMacroBodyApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentMacroBodyConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentBodyConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentBodyConsumerApi.class, ConfluenceClientContentBodyApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentBodyConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentCommentsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentCommentsConsumerApi.class, ConfluenceClientContentCommentsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentCommentsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentLabelsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentLabelsConsumerApi.class, ConfluenceClientContentLabelsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentLabelsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentPermissionsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentPermissionsConsumerApi.class, ConfluenceClientContentPermissionsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentPermissionsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentPropertiesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentPropertiesConsumerApi.class, ConfluenceClientContentPropertiesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentPropertiesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentRestrictionsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentRestrictionsConsumerApi.class, ConfluenceClientContentRestrictionsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentRestrictionsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentStatesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentStatesConsumerApi.class, ConfluenceClientContentStatesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentStatesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentVersionsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentVersionsConsumerApi.class, ConfluenceClientContentVersionsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentVersionsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientContentWatchesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientContentWatchesConsumerApi.class, ConfluenceClientContentWatchesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientContentWatchesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientDynamicModulesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientDynamicModulesConsumerApi.class, ConfluenceClientDynamicModulesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientDynamicModulesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientExperimentalConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientExperimentalConsumerApi.class, ConfluenceClientExperimentalApi.class, (ConfluenceClientFactorySpec<ConfluenceClientExperimentalConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientGroupConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientGroupConsumerApi.class, ConfluenceClientGroupApi.class, (ConfluenceClientFactorySpec<ConfluenceClientGroupConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientInlineTasksConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientInlineTasksConsumerApi.class, ConfluenceClientInlineTasksApi.class, (ConfluenceClientFactorySpec<ConfluenceClientInlineTasksConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientLabelInfoConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientLabelInfoConsumerApi.class, ConfluenceClientLabelInfoApi.class, (ConfluenceClientFactorySpec<ConfluenceClientLabelInfoConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientLongRunningTaskConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientLongRunningTaskConsumerApi.class, ConfluenceClientLongRunningTaskApi.class, (ConfluenceClientFactorySpec<ConfluenceClientLongRunningTaskConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientRelationConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientRelationConsumerApi.class, ConfluenceClientRelationApi.class, (ConfluenceClientFactorySpec<ConfluenceClientRelationConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSearchConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSearchConsumerApi.class, ConfluenceClientSearchApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSearchConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSettingsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSettingsConsumerApi.class, ConfluenceClientSettingsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSettingsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSpaceConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSpaceConsumerApi.class, ConfluenceClientSpaceApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSpaceConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSpacePermissionsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSpacePermissionsConsumerApi.class, ConfluenceClientSpacePermissionsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSpacePermissionsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSpacePropertiesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSpacePropertiesConsumerApi.class, ConfluenceClientSpacePropertiesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSpacePropertiesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientSpaceSettingsConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientSpaceSettingsConsumerApi.class, ConfluenceClientSpaceSettingsApi.class, (ConfluenceClientFactorySpec<ConfluenceClientSpaceSettingsConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientTemplateConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientTemplateConsumerApi.class, ConfluenceClientTemplateApi.class, (ConfluenceClientFactorySpec<ConfluenceClientTemplateConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientThemesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientThemesConsumerApi.class, ConfluenceClientThemesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientThemesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientUserPropertiesConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientUserPropertiesConsumerApi.class, ConfluenceClientUserPropertiesApi.class, (ConfluenceClientFactorySpec<ConfluenceClientUserPropertiesConsumerApi>) config);
        }
        if (config.api() == ConfluenceClientUsersConsumerApi.class) {
            return (T) ConfluenceClientFactory.buildConsumerClient(ConfluenceClientUsersConsumerApi.class, ConfluenceClientUsersApi.class, (ConfluenceClientFactorySpec<ConfluenceClientUsersConsumerApi>) config);
        }

        throw new IllegalArgumentException("api must be an compatible interface or consumer class");
    }

    public static ConfluenceClientApi create() {
        return create(spec -> spec.api(ConfluenceClientApi.class));
    }

    private static <T, U> T buildConsumerClient(Class<T> consumerApiClass, Class<U> apiClass, ConfluenceClientFactorySpec<T> config) {
        try {
            U api = buildClient(s -> {
                s.api(apiClass);
                s.applySpec(config);
            });
            return consumerApiClass.getConstructor(apiClass).newInstance(api);
        } catch (Exception ex) {
            throw new IllegalArgumentException("API must have a constructor with one parameter of type " + apiClass.getSimpleName(), ex);
        }
    }

    private static <T> T buildClient(Consumer<ConfluenceClientFactorySpec<T>> spec) {
        ConfluenceClientFactorySpec<T> config = new ConfluenceClientFactorySpec<>(spec);

        // http client
        okhttp3.OkHttpClient.Builder clientBuilder = new okhttp3.OkHttpClient.Builder();
        if (config.proxy() != null && config.proxy().type() != Proxy.Type.DIRECT) {
            clientBuilder.proxy(new Proxy(config.proxy().type(), new InetSocketAddress(config.proxy().host(), config.proxy().port())));
            if (config.proxy().username() != null || config.proxy().password() != null) {
                clientBuilder.proxyAuthenticator((route, response) -> {
                    return response.request().newBuilder()
                            .header("Proxy-Authorization", Credentials.basic(config.proxy().username(), new String(config.proxy().password())))
                            .build();
                });
            }
        }

        // insecure
        if (config.insecure()) {
            try {
                TrustManager[] trustAllCerts = new TrustManager[]{
                    new X509TrustManager() {
                        @Override
                        public void checkClientTrusted(java.security.cert.X509Certificate[] chain, String authType) {}

                        @Override
                        public void checkServerTrusted(java.security.cert.X509Certificate[] chain, String authType) {}

                        @Override
                        public java.security.cert.X509Certificate[] getAcceptedIssuers() {
                            return new java.security.cert.X509Certificate[]{};
                        }
                    }
                };

                SSLContext sslContext = SSLContext.getInstance("SSL");
                sslContext.init(null, trustAllCerts, new java.security.SecureRandom());

                clientBuilder.hostnameVerifier((hostname, session) -> true);
                clientBuilder.sslSocketFactory(sslContext.getSocketFactory(), (X509TrustManager) trustAllCerts[0]);
            } catch (Exception ex) {
                throw new RuntimeException("failed to configure insecure mode", ex);
            }
        }

        // objectMapper
        JsonMapper.Builder objectMapperBuilder = JsonMapper.builder()
                .enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_ENUMS)
                .enable(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE)
                .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES)
                .propertyNamingStrategy(PropertyNamingStrategies.LOWER_CAMEL_CASE)
                .configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false)
                .addModule(new JavaTimeModule());
        config.extensions().forEach(extension -> extension.customizeObjectMapper(objectMapperBuilder));
        ObjectMapper objectMapper = objectMapperBuilder.build();

        // builder
        return Feign.builder()
                .client(new OkHttpClient(clientBuilder.build()))
                .encoder(new JacksonEncoder(objectMapper))
                .decoder(new JacksonDecoder(objectMapper))
                .logger(new Slf4jLogger())
                .logLevel(Logger.Level.valueOf(config.logLevel().toUpperCase()))
                .addCapability(new MicrometerCapability(config.meterRegistry()))
                .addCapability(new PrimeCapability(config.backendName(), config.extensions()))
                .requestInterceptor(new AuthInterceptor(config.auth()))
                .decodeVoid()
                .target(config.api(), config.baseUrl());
    }
}
